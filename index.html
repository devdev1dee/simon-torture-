<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Simon's Bad Day - POV</title>
    <style>
        body { margin: 0; background: #050505; color: #ff0000; font-family: 'Courier New', Courier, monospace; overflow: hidden; }
        canvas { background: radial-gradient(circle, #1a1a1a 0%, #000 100%); display: block; cursor: crosshair; }
        #ui { position: absolute; top: 20px; width: 100%; text-align: center; pointer-events: none; text-shadow: 2px 2px #000; }
        #level-msg { position: absolute; top: 50%; width: 100%; text-align: center; font-size: 40px; color: white; display: none; }
        #hint { position: absolute; bottom: 10px; width: 100%; text-align: center; color: #555; font-size: 12px; }
    </style>
</head>
<body>

    <div id="ui">
        <h1>PELT SIMON HENRIKSSON</h1>
        <p>HITS: <span id="score">0</span> / 10</p>
    </div>
    <div id="level-msg">HE'S PINNED. FINISH HIM.</div>
    <div id="hint">Tip: Aim slightly ahead of him!</div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const msgEl = document.getElementById('level-msg');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let score = 0;
        let level = 1;
        let tomatoes = [];
        let splats = [];

        const simon = {
            x: canvas.width / 2,
            y: canvas.height / 2 + 50,
            velX: 0,
            friction: 0.8, // Slightly higher friction so he doesn't slide forever
            panic: 1.5,    // Reduced panic so he's less "twitchy"
            width: 80,
            height: 120
        };

        class Tomato {
            constructor(tx, ty) {
                this.x = canvas.width / 2;
                this.y = canvas.height + 50;
                this.tx = tx; this.ty = ty;
                this.progress = 0;
                this.speed = 0.08; // INCREASED SPEED: Makes it much easier to hit him
                this.size = 80;
                this.active = true;
            }
            update() {
                this.progress += this.speed;
                this.x = (canvas.width / 2) + (this.tx - (canvas.width / 2)) * this.progress;
                this.y = (canvas.height + 50) + (this.ty - (canvas.height + 50)) * this.progress;
                this.size = 80 * (1 - this.progress * 0.7);
                if (this.progress >= 1) {
                    this.active = false;
                    checkHit(this.tx, this.ty);
                }
            }
            draw() {
                ctx.font = `${this.size}px serif`;
                ctx.fillText("ðŸ…", this.x - this.size/2, this.y);
            }
        }

        function checkHit(tx, ty) {
            // Hitbox is now slightly more generous
            const hit = tx > simon.x - 50 && tx < simon.x + 50 && ty > simon.y - 110 && ty < simon.y + 30;
            if (hit) {
                score++;
                scoreEl.innerText = score;
                // Add a visual "flash" when hit
                splats.push({x: tx, y: ty, size: 60, life: 40, color: `rgba(255,0,0,`});
                if (score >= 10 && level === 1) startLevel2();
            }
        }

        function startLevel2() {
            level = 2;
            msgEl.style.display = "block";
            setTimeout(() => msgEl.style.display = "none", 3000);
        }

        function drawSimon(x, y) {
            ctx.save();
            ctx.translate(x, y);

            if (level === 2) {
                ctx.fillStyle = "#2b1d0e";
                ctx.fillRect(-10, -180, 20, 250); 
                ctx.fillRect(-80, -100, 160, 20); 
                ctx.fillStyle = "rgba(0, 200, 255, 0.6)";
                ctx.font = "20px Arial";
                ctx.fillText("ðŸ’§", -15 + Math.sin(Date.now()/200)*2, -60);
                ctx.fillText("ðŸ’§", 5 + Math.cos(Date.now()/200)*2, -60);
            }

            // Hoodie Body
            ctx.fillStyle = "#4a4a4a"; 
            ctx.beginPath();
            ctx.moveTo(-35, 30);
            ctx.lineTo(-45, -85);
            ctx.quadraticCurveTo(0, -120, 45, -85);
            ctx.lineTo(35, 30);
            ctx.fill();

            // Shadowed Face
            ctx.fillStyle = "#c2a382";
            ctx.beginPath();
            ctx.arc(0, -78, 22, 0, Math.PI*2);
            ctx.fill();

            // Hood/Hair Shadow
            ctx.fillStyle = "#111";
            ctx.beginPath();
            ctx.arc(0, -88, 25, Math.PI, 0); 
            ctx.fill();
            ctx.fillRect(-22, -88, 44, 18); 

            ctx.restore();
        }

        canvas.addEventListener('mousedown', (e) => {
            tomatoes.push(new Tomato(e.clientX, e.clientY));
        });

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (level === 1) {
                // REDUCED DODGE RADIUS: He only panics if the tomato is very close
                tomatoes.forEach(t => {
                    if (t.progress > 0.6 && t.progress < 0.9 && Math.abs(t.tx - simon.x) < 80) {
                        simon.velX += (simon.x > t.tx ? simon.panic : -simon.panic);
                    }
                });

                // TETHER
                const margin = 200;
                if (simon.x < margin) simon.velX += 1.5;
                if (simon.x > canvas.width - margin) simon.velX -= 1.5;

                simon.x += simon.velX;
                simon.velX *= simon.friction;
            }

            drawSimon(simon.x, simon.y);

            splats.forEach((s, i) => {
                ctx.fillStyle = s.color + (s.life/40) + ")";
                ctx.beginPath(); ctx.arc(s.x, s.y, s.size, 0, Math.PI*2); ctx.fill();
                s.life--; if(s.life<=0) splats.splice(i,1);
            });

            tomatoes.forEach((t, i) => {
                t.update(); t.draw();
                if(!t.active) tomatoes.splice(i,1);
            });

            requestAnimationFrame(animate);
        }

        animate();

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            simon.y = canvas.height / 2 + 50;
        });
    </script>
</body>
</html>
