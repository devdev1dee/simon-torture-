<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Simon's Bad Day - POV</title>
    <style>
        body { margin: 0; background: #050505; color: #ff0000; font-family: 'Courier New', Courier, monospace; overflow: hidden; }
        canvas { background: radial-gradient(circle, #1a1a1a 0%, #000 100%); display: block; cursor: crosshair; }
        #ui { position: absolute; top: 20px; width: 100%; text-align: center; pointer-events: none; text-shadow: 2px 2px #000; }
        #level-msg { position: absolute; top: 50%; width: 100%; text-align: center; font-size: 40px; color: white; display: none; }
    </style>
</head>
<body>

    <div id="ui">
        <h1>PELT SIMON HENRIKSSON</h1>
        <p>HITS: <span id="score">0</span> / 10</p>
    </div>
    <div id="level-msg">HE'S PINNED. FINISH HIM.</div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const msgEl = document.getElementById('level-msg');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let score = 0;
        let level = 1;
        let tomatoes = [];
        let splats = [];

        const simon = {
            x: canvas.width / 2,
            y: canvas.height / 2 + 50,
            velX: 0,
            friction: 0.85,
            panic: 2.2,
            width: 80,
            height: 120
        };

        class Tomato {
            constructor(tx, ty) {
                this.x = canvas.width / 2;
                this.y = canvas.height + 50;
                this.tx = tx; this.ty = ty;
                this.progress = 0;
                this.speed = 0.05;
                this.size = 80;
                this.active = true;
            }
            update() {
                this.progress += this.speed;
                this.x = (canvas.width / 2) + (this.tx - (canvas.width / 2)) * this.progress;
                this.y = (canvas.height + 50) + (this.ty - (canvas.height + 50)) * this.progress;
                this.size = 80 * (1 - this.progress * 0.7);
                if (this.progress >= 1) {
                    this.active = false;
                    checkHit(this.tx, this.ty);
                }
            }
            draw() {
                ctx.font = `${this.size}px serif`;
                ctx.fillText("ðŸ…", this.x - this.size/2, this.y);
            }
        }

        function checkHit(tx, ty) {
            const hit = tx > simon.x - 40 && tx < simon.x + 40 && ty > simon.y - 100 && ty < simon.y + 20;
            if (hit) {
                score++;
                scoreEl.innerText = score;
                splats.push({x: tx, y: ty, size: 40, life: 50, color: `rgba(200,0,0,`});
                if (score >= 10 && level === 1) startLevel2();
            }
        }

        function startLevel2() {
            level = 2;
            msgEl.style.display = "block";
            setTimeout(() => msgEl.style.display = "none", 3000);
        }

        function drawSimon(x, y) {
            ctx.save();
            ctx.translate(x, y);

            if (level === 2) {
                // The Cross
                ctx.fillStyle = "#2b1d0e";
                ctx.fillRect(-10, -180, 20, 250); // Vertical
                ctx.fillRect(-80, -100, 160, 20); // Horizontal
                // Crying bubbles
                ctx.fillStyle = "rgba(0, 200, 255, 0.5)";
                ctx.beginPath();
                ctx.arc(-10 + Math.sin(Date.now()/200)*5, -60, 5, 0, Math.PI*2);
                ctx.arc(10 + Math.cos(Date.now()/200)*5, -60, 5, 0, Math.PI*2);
                ctx.fill();
            }

            // Simon Graphics (Grey Hoodie Look)
            // Body/Hoodie
            ctx.fillStyle = "#4a4a4a"; 
            ctx.beginPath();
            ctx.moveTo(-30, 20);
            ctx.lineTo(-40, -80);
            ctx.quadraticCurveTo(0, -110, 40, -80);
            ctx.lineTo(30, 20);
            ctx.fill();

            // Face (Shadowed)
            ctx.fillStyle = "#d2b48c";
            ctx.beginPath();
            ctx.arc(0, -75, 20, 0, Math.PI*2);
            ctx.fill();

            // Messy Hair/Hood Shadow
            ctx.fillStyle = "#1a1a1a";
            ctx.beginPath();
            ctx.arc(0, -85, 22, Math.PI, 0); // Hair top
            ctx.fill();
            ctx.fillRect(-20, -85, 40, 15); // Hood shadow over eyes

            ctx.restore();
        }

        canvas.addEventListener('mousedown', (e) => {
            tomatoes.push(new Tomato(e.clientX, e.clientY));
        });

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (level === 1) {
                // HUMAN-LIKE DODGING AI
                // 1. Avoid Mouse
                let distToMouse = Math.abs(simon.x - (window.mouseX || canvas.width/2));
                if (distToMouse < 200) {
                    simon.velX += (simon.x > (window.mouseX || 0) ? simon.panic : -simon.panic);
                }

                // 2. Avoid incoming Tomatoes
                tomatoes.forEach(t => {
                    if (t.progress > 0.5 && Math.abs(t.tx - simon.x) < 100) {
                        simon.velX += (simon.x > t.tx ? simon.panic : -simon.panic);
                    }
                });

                // 3. TETHER: Don't let him leave the frame!
                const margin = 150;
                if (simon.x < margin) simon.velX += 3;
                if (simon.x > canvas.width - margin) simon.velX -= 3;

                simon.x += simon.velX;
                simon.velX *= simon.friction;
            }

            drawSimon(simon.x, simon.y);

            // Update Elements
            splats.forEach((s, i) => {
                ctx.fillStyle = s.color + (s.life/50) + ")";
                ctx.beginPath(); ctx.arc(s.x, s.y, s.size, 0, Math.PI*2); ctx.fill();
                s.life--; if(s.life<=0) splats.splice(i,1);
            });

            tomatoes.forEach((t, i) => {
                t.update(); t.draw();
                if(!t.active) tomatoes.splice(i,1);
            });

            requestAnimationFrame(animate);
        }

        window.addEventListener('mousemove', (e) => window.mouseX = e.clientX);
        animate();

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            simon.y = canvas.height / 2 + 50;
        });
    </script>
</body>
</html>
